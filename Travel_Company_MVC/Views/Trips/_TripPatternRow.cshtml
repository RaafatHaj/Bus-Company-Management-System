@using Newtonsoft.Json
@using TravelCompany.Domain.Const
@model TripsPatternViewModel

@* No Regular Reccuring Pattern

Multiple Reccuring Pattern Exists *@

<tr>

    <td>




            @*                <i class="ki-duotone ki-black-up fs-1 ">  </i> *@
            @*                     <div class="bullet w-8px h-3px rounded-2 bg-secendory mt-2"></div>
            <span class="bullet bullet-dot bg-gray-600 mt-2"></span> *@

            @{
                var data = new RetrivePatternWeeksDTO
                {
                    RouteId=Model.RouteId,
                    Time=Model.Time,
                    StartDate=Model.StartDate!.Value,
                    EndDate=Model.EndDate!.Value
                };

                var jsonData = JsonConvert.SerializeObject(data);

            }

            <div class="d-flex">
            <span class="bullet bullet-dot  bg-gray-500  mt-3  "></span>
            <div>
                <a href="#"
                   class="text-gray-900 fw-bold text-hover-primary mb-1 ms-2">
                    @DateTime.Today.Add(Model.Time).ToString("HH:mm")
                    @(Model.Time > new TimeSpan(12, 0, 0) ? "Pm" : "Am")
                </a>
                <div class="d-flex gap-1">

                    @{
                        string color = "";
                        if (Model.PatternType == PatternType.Daily)
                            color = "badge-light-primary";
                        else if (Model.PatternType == PatternType.Weekly)
                            color = "badge-light-warning";
                        else if (Model.PatternType == PatternType.Mixed)
                            color = "badge-light-info";
                        else if (Model.PatternType == PatternType.Custom)
                            color = "badge-light";

                    }


                    <a href="#" class=" badge fw-semibold  @color  ">@Model.PatternType</a>


                    <span class="text-muted fw-semibold fs-7 ">@(Convert.ToInt32(Model.Percentage))%</span>
                </div>

            </div>


            </div>
     

     






    </td>
    <td>


        



               
                @{
                    if(Model.OccupiedWeekDaysCode is null)
                    {
                <span class="text-muted fw-semibold fs-7 ">Multiple Reccuring Pattern Exists</span>

                     
                    }
                    else
                    {
                <div class="d-flex flex-column">
                    <div class="d-flex gap-4 ms">
                        @{

                            foreach (WeekDaysCode day in Enum.GetValues(typeof(WeekDaysCode)))
                            {
                                if ((Model.OccupiedWeekDaysCode & (int)day) == (int)day)
                                {
                                    <div class="text-primary fs-7">@day</div>
                                }
                                else
                                {
                                    <div class="text-muted fs-7">@day</div>
                                }
                            }
                        }
                     </div>
                    <span class="text-muted fw-semibold fs-7 ">Occupied Days</span>

                </div>

                    }

                }

             

            <div>
            </div>


        










    </td>

    <td>

        <div class="d-flex">

            <i class="ki-duotone ki-black-up fs-1 ">  </i>
            <!--begin::Item-->
            <div class="m-0">


                <!--begin::Label-->
                <!--begin::Title-->

                <a href="#"
                   class="text-gray-900 fw-bold d-block text-hover-primary me-2">@Model.StartDate!.Value.ToString("dd MMM yyyy")</a>
                <span class="text-muted fw-semibold fs-7">From</span>


            </div>
            <!--end::Item-->
        </div>




    </td>
    <td>

        <div class="d-flex">

            <i class="ki-duotone ki-black-down fs-1 ">  </i>


            <!--begin::Item-->
            <div class="m-0">


                <!--begin::Label-->
                <!--begin::Title-->

                <a href="#"
                   class="text-gray-900 fw-bold d-block text-hover-primary me-2">@Model.EndDate!.Value.ToString("dd MMM yyyy")</a>
                <span class="text-muted fw-semibold fs-7 ">To</span>


            </div>
            <!--end::Item-->
        </div>



    </td>

@*
    <td>

        <div class="d-flex ">

            <div class="">
                <i class="ki-duotone ki-arrow-up fs-5 text-primary  mt-1">
                    <span class="path1"></span>
                    <span class="path2"></span>
                </i>

            </div>

            <div>
                <div class="text-gray-900 fw-bold">
                    @Model.TripsNumber <span class="text-gray-900 fw-semibold fs-7 ">Trips</span>
                </div>
         
                <span class="text-muted fw-semibold fs-7 ms-2">Total</span>
            </div>


        </div>








    </td>
    <td>


        <a href="#"
           class="text-gray-900 fw-bold d-block text-hover-primary me-2">
            <i class="ki-duotone ki-arrow-down fs-5 text-danger ms-n1">
                <span class="path1"></span>
                <span class="path2"></span>
            </i>@Model.UnassignedTripsNumber <span class="text-gray-900 fw-semibold fs-7 ">Trips</span>
        </a>
        <span class="text-muted fw-semibold fs-7 ">Unassigned</span>

    </td>
    *@

    <td>

    <div class="d-flex">
            <a class="btn text-gray-900 text-hover-primary  fw-bold d-block  m-0 p-0 js-table-chiled"
               data-url="/Trips/GetPatternWeeks"
               data-json-data="@jsonData">
                <span class="bullet bullet-dot  bg-gray-500 me-1 mt-2  "></span>
                @Model.OccupiedWeeksNumber
                <span class="text-muted fw-semibold fs-7 text-hover-primary ">Week</span>

            </a>
    </div>
        <div class="d-flex">
            <a class="btn text-gray-900 fw-bold d-block text-hover-primary m-0 p-0 js-render-modal"
               data-url="/Trips/GetScheduledTrips?routeId=@Model.RouteId&time=@Model.Time"
               data-large-modal="true"
               data-title="Scheduled Trips"
               data-sub-title="all trips scheduled at selected time."
               data-has-table="true"
               data-table-id="Scheduled_Trips_Table">
                <span class="bullet bullet-dot  bg-gray-500 me-1 mt-2  "></span>
                @Model.TripsNumber
                <span class="text-muted fw-semibold fs-7 text-hover-primary ">Trip</span>

            </a>
        </div>
        

    </td>
    <td class="text-end">
        <a href="#" class="btn btn-sm btn-light btn-flex btn-center btn-active-light-primary" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end">
            Actions
            <i class="ki-duotone ki-down fs-5 ms-1"></i>
        </a>
        <!--begin::Menu-->
        <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4" data-kt-menu="true" style="">
            <!--begin::Menu item-->
            <div class="menu-item px-3">
                <a href="apps/ecommerce/catalog/edit-product.html" class="menu-link px-3">Edit</a>
            </div>
            <!--end::Menu item-->
            <!--begin::Menu item-->
            <div class="menu-item px-3">
                <a href="#" class="menu-link px-3" data-kt-ecommerce-product-filter="delete_row">Delete</a>
            </div>
            <!--end::Menu item-->
        </div>
        <!--end::Menu-->
    </td>

</tr>
